<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="favicon.ico">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
    <title>서머너즈워 데미지 계산기</title>
    <style>
        body {
            overflow-x: auto;
            margin: 0%;
        }

        ::-webkit-scrollbar {
            width: 20px;
        }

        ::-webkit-scrollbar-track {
            box-shadow: inset 0 0 3px grey;
        }

        ::-webkit-scrollbar-thumb {
            border: 1px solid #009933;
        }

        ::-webkit-scrollbar-button:hover {
            background: #009933;
        }

        ::-webkit-scrollbar-button:active {
            background: green;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #009933;
        }

        ::-webkit-scrollbar-thumb:active {
            background: green;
        }

        * {
            box-sizing: border-box;
        }

        scrollbar-track {
            background: white;
            border: 1px solid green;
        }

        .row::after {
            content: "";
            clear: both;
            display: table;
        }

        select {
            margin: 8px;
            padding: 5px 0;
            transform: scale(1.1);
        }

        [type="checkbox"] {
            transform: scale(2);
            margin: 8px;
        }

        table {
            width: 100%;
            border: 1px solid grey;
            border-radius: 5px;
        }

        tr:hover {
            background: #eee;
        }

        input[type="number"] {
            font-size: 15px;
            width: auto;
            max-width: 85px;
        }

        input[type="number"],
        input[type="text"] {
            border: 2px solid #ccc;
            padding: 4px;
            border-radius: 2px;
            margin: 5px;
        }

        input[type="number"]:focus,
        input[type="text"]:focus {
            outline: none;
            border: 2px solid #555;
        }

        .white_button {
            text-align: center;
            min-height: 30px;
            font-size: 16px;
            display: inline-block;
            border: 1px solid green;
            color: green;
            background-color: white;
            text-decoration: none;
            width: 100%;
        }

        .green_button {
            text-align: center;
            min-height: 30px;
            font-size: 16px;
            display: inline-block;
            border: 1px solid darkgrey;
            color: white;
            background-color: green;
            text-decoration: none;
            width: 100%;
        }
        .white_button:hover{
            background-color: darkslategray;
            color:honeydew;
        }
        .toggle_button:active{
            background-color: darkseagreen;
        }
        .header {
            text-align: center;
        }

        footer {
            padding: 20px 0 40px 0;
        }

        [id="view_recode"] {
            position: fixed;
            bottom: 10px;
            left: 150px;
        }

        [id="copy_clipboard"] {
            position: fixed;
            bottom: 10px;
            left: 10px;
        }
        [id="now_status_save"] {
            position: fixed;
            bottom: 10px;
            left: 150px;
        }
        [id="input_reset"] {
            position: fixed;
            bottom: 10px;
            left: 220px;
        }

        .decorate,
        [type='button'],
        a,
        button {
            text-align:center;
            font-size: 16px;
            display: inline-block;
            border: 1px solid green;
            padding: 6px 13px;
            color: green;
            background-color: white;
            text-decoration: none;
            transition: 0.2s;
        }

        label {
            font-size: 16px;
            display: inline-block;
            border: 1px solid green;
            padding: 2px 10px;
            color: green;
            background-color: white;
            text-decoration: none;
            transition: 0.2s;
        }
        .decorate:hover,
        a:hover,
        button:hover,
        [type='button']:hover{
            color: white;
            background-color: green;
        }

        a:active {
            color: white;
            background-color: green;
        }


        a span.link {
            transition: 0.2s;
        }

        span.link:after {
            content: '>>';
            opacity: 0;
            transition: 0.2s;
        }

        a:hover span.link:after {
            opacity: 1;
        }

        div.result {
            position: fixed;
            right: 10px;
            bottom: 10px;
            border: 3px solid black;
            border-radius: 10px;
            padding: 15px;
            height: 140px;
            font-size: 30px;
        }

        div.result:hover {
            background: #eee;
        }

        #record {
            visibility: hidden;
            display: none;
            border: 2px solid black;
            border-radius: 5px;
            padding: 50px 10px 10px 15px;
            position: fixed;
            width: 100%;
            top: 10%;
            height: 400px;
            z-index: 1;
            background-color: #fff;
            overflow: auto;
        }

        .record_text:hover {
            background: #eee;
        }

        .icon {
            position: absolute;
            margin-top: 3px;
            top: 1%;
            border: 1px solid black;
            width: 40px;
            height: 36px;
            padding: 0;
            text-align: center;
            font-size: 20px;
            cursor: pointer;
        }

        .tool_container {
            position: relative;
            display: inline-block;
        }

        [class*="tool_text"] {
            visibility: hidden;
            color: #fff;
            background-color: #555;
            border-radius: 10px;
            padding: 5px;
            opacity: 0;
            position: absolute;
            z-index: 999;
            top: 95%;
            left: -100%;
        }

        .attack .tool_text {
            left: -100%;
        }

        .result .tool_text {
            left: 0%;
            top: -50%;
        }

        .tool_text {
            min-width: 320px;
        }

        .tool_container:hover [class*="tool_text"] {
            opacity: 1;
            visibility: visible;
        }

        [class*="col-"] {
            float: left;
        }

        .col-1 {
            width: 8.33%;
        }

        .col-2 {
            width: 16.66%;
        }

        .col-3 {
            width: 25%;
        }

        .col-4 {
            width: 33.33%;
        }

        .col-5 {
            width: 41.66%;
        }

        .col-6 {
            width: 50%;
        }

        .col-7 {
            width: 58.33%;
        }

        .col-8 {
            width: 66.66%;
        }

        .col-9 {
            width: 75%;
        }

        .col-10 {
            width: 83.33%;
        }

        .col-11 {
            width: 91.66%;
        }

        .col-12 {
            width: 100%;
        }

        @media only screen and (max-width: 768px) {
            [class*="col-"] {
                width: 100%;
            }

            table {
                width: 100%;
            }

            div.result {
                position: static;
            }

            #record {
                border: 2px solid black;
                border-radius: 5px;
                padding: 50px 10px 10px 15px;
                margin: 0%;
                position: fixed;
                width: 100%;
                top: 10%;
                height: 400px;
            }

            .tool_text {
                left: -150px;
            }

            .multi .tool_text {
                left: -300px;
            }

            .dimension {
                left: -180px;
            }

            .result .tool_text {
                left: 0%;
                top: -50%;
            }
        }
    </style>
</head>


<body onkeydown="if(event.keyCode == 13){ damageCalculate();}
else if (event.keyCode == 27) {
  exitRecord();
};" onbeforeunload="byebye()">
    <header>
        <h1 class="header col-12">서머너즈워 데미지 계산기</h1>
        <h4>"입력값 초기화"는 입력들을 기본값으로 돌려놓습니다.</h4>
        <h4>아티팩트 추가딜은 증뎀류(낙인 등)를 받는다고 가정합니다.</h4>
    </header><br />
    <script>
const STAT_SAVE_DATA_LIST = 'STAT_SAVE_DATA_LIST';
var save_data_map;
function byebye(){
saveInputData(true);
localStorage.setItem(STAT_SAVE_DATA_LIST, JSON.stringify(Array.from(save_data_map.entries())));
}
</script>
    <section>
        <form id="reset_form">
            <div class="row">
                <div class="col-7 main">
                    <table id='stat_info_table'>
                        <tr>
                            <th><a onclick='load_monster_info(this)'>자동세팅<br>정보 불러오기<br>[Click]</a></th>
                            <td>
                                <input id="monster-name" type="text" list="all-multiplier"
                                    onchange='change_multiplier_select()' onclick='this.value=""'>
                                <datalist id='all-multiplier'>
                                </datalist>
                                <select id="multi_selector_en" style="width:200px;" onchange="set_multiplier(this)">
                                    <option>
                                        검색
                                    </option>
                                </select>
                            </td>
                            <script>
                                //[이름, [[[계수, 계수2], 표기], ...],[체,공,방,속]],[...]]
                                monster_list = [];
                                monster_idx_by_name = new Map();
                                function change_multiplier_select() {
                                    obj = document.getElementById("multi_selector_en");
                                    let idx = monster_idx_by_name.get(document.getElementById("monster-name").value);
                                    if (idx == undefined) return;
                                    obj.innerHTML = "<option>검색</option>";
                                    for (let i in monster_list[idx][1]) {
                                        multiplier = monster_list[idx][1][i][1];
                                        if (multiplier == undefined) continue;
                                        //value = (monster idx).(skill num)
                                        obj.innerHTML += "<option value='" + idx + "." + i + "'>" +
                                            (parseInt(i) + 1) + "번 스킬:" + multiplier + "</option>";
                                    }
                                    for(let i=0; i<4;i++){
                                    stat_infos[i].getElementsByClassName('base')[0].value =monster_list[idx][2][i];
                                    }
                                }
                                function set_multiplier(obj) {
                                    if (obj.value == null) return;
                                    let info = obj.value.split('.');
                                    let idx = info[0];
                                    let skill_num = info[1];
                                    document.getElementById("auto_setting_alert").innerHTML = "계수 타입 확인바람.";
                                    try {
                                        for(let i =0; i<2; i++){
                                        document.getElementsByClassName("skill_multi")[i].value = monster_list[idx][1][skill_num][0][i];
                                        }
                                    }
                                    catch (e) {}
                                }
                                function readTextFile(file) {
                                    var rawFile = new XMLHttpRequest();
                                    rawFile.open("GET", file, false);
                                    rawFile.onreadystatechange = function () {
                                        if (rawFile.readyState === 4) {
                                            if (rawFile.status === 200 || rawFile.status == 0) {
                                                var allText = rawFile.responseText;
                                                monster_list = JSON.parse(allText);
                                                let monster_name_detaillist = document.getElementById("all-multiplier");
                                                for (let i in monster_list) {
                                                    name = monster_list[i][0];
                                                    monster_idx_by_name.set(name, i);
                                                    monster_name_detaillist.innerHTML +=
                                                        "<option value='" + name + "'></option>";
                                                }
                                            }
                                        }
                                    };
                                    rawFile.send(null);
                                }
                                let filename = "https://veev23.github.io/2018-swar/monster_info.txt";
                                function load_monster_info(obj) {
                                    if (monster_list.length > 0) {
                                        return;
                                    }
                                    readTextFile(filename);
                                    alert("어떤 몹들의 계수들은 갱신이 되지 않아 현재의 계수와 다를 수 있음에 유의해주세요.(ex:닌자류 평타계수)\n나중에 시간나면 다른 곳에서 찾아올게요..");
                                    obj.innerHTML = "자동세팅(영어)";
                                }


                            </script>
                        </tr>
                        <tr>
                            <th>자동세팅</th>
                            <td>
                                <select class="auto_multi_select" onchange="multiAutoSelect(this)">
                                </select>
                                <span id="auto_setting_alert">자동세팅은 필수사항 아님</span>
                            </td>
                        </tr>
                    </table>
                    <table id='artifact_info_table'>
                    <tr><th>아티팩트 효과<th></tr>
                    </table>
                    <script>
                        const stat_info_table = document.getElementById('stat_info_table');
                        const artifact_info_table = document.getElementById('artifact_info_table');
                        const STAT_HP = "hp"; const STAT_HP_IDX = 0;
                        const STAT_ATK = "atk"; const STAT_ATK_IDX = 1;
                        const STAT_DEF = "def"; const STAT_DEF_IDX = 2;
                        const STAT_SPD = "spd"; const STAT_SPD_IDX = 3;
                        const STAT_CD = "cd"; const STAT_CD_IDX = 4;

                        const statClassName = ['hp', 'atk', 'def', 'spd', 'cd'];
                        const strList = ["체력", "공격력", "방어력", "공격속도", "치명피해"];

                        function make_stat_info(parent, name, className) {
                            let blankstr = '';
                            let row = document.createElement('tr');
                            row.classList.add(className);
                            row.innerHTML = '<th>' + name + '</th>';
                            let td = document.createElement('td');
                            td.innerHTML = '<input type="number" class="base" id="b' + className + '" placeholder="기본스텟">+';
                            if (name != "치명피해")
                                td.innerHTML += '<input type="number" class="rune" id="r' + className + '"'
                                    + 'title="룬으로 오르는 수치를 입력하세요." placeholder="추가수치"> + ';
                            td.innerHTML += '<input type="number" class="disp" id="d' + className + '" '
                                + 'onchange="changeTextColorByNumber(this)" placeholder="룬변경시" '
                                + 'onmousedown="this.value=' + blankstr + ';">'
                                + '= <span class="tool_container"><span class="sum"></span>'
                                + '<span class="tool_text"></span></span></td>';
                            row.appendChild(td);
                            parent.appendChild(row);
                            return row;
                        }
                        var stat_infos = [];
                        function make_stat_info_table() {
                            for (i in strList) {
                                stat_infos[i] = make_stat_info(stat_info_table, strList[i], statClassName[i]);
                            }
                        }
                        function make_arti_info(strs) {
                            let th = document.createElement('th');
                            let td = document.createElement('td');
                            if(strs != undefined){
                            let name = strs[0];
                            let className = strs[1];
                            let blankstr = '';
                            th.innerHTML = name;
                            td.innerHTML = '<input type="number" class="'+className+'" id="' + className + '" placeholder="%">';
                            }
                            return [th, td];
                        }
                        const ARTIFACT_ATK_BUFF = 'arti_abuff';
                        const ARTIFACT_DEF_BUFF = 'arti_dbuff';
                        const ARTIFACT_SPD_BUFF = 'arti_sbuff';
                        const ARTIFACT_HP_DEAL = 'arti_hdeal';
                        const ARTIFACT_ATK_DEAL = 'arti_adeal';
                        const ARTIFACT_DEF_DEAL = 'arti_ddeal';
                        const ARTIFACT_SPD_DEAL = 'arti_sdeal';
                        function make_artifact_info_table(){
                            const buffs = 
                            [["공업 증가량", ARTIFACT_ATK_BUFF],["방업 증가량", ARTIFACT_DEF_BUFF], ["속업 증가량", ARTIFACT_SPD_BUFF]];
                            const deals = [["체력 추가딜", ARTIFACT_HP_DEAL], ["공격력 추가딜", ARTIFACT_ATK_DEAL], 
                            ["방어력 추가딜", ARTIFACT_DEF_DEAL], ["공격속도 추가딜", ARTIFACT_SPD_DEAL]];
                            let max_len = buffs.length > deals.length ? buffs.length : deals.length;
                            for(let i = 0; i<max_len; i++){
                            let row = document.createElement('tr');
                            let t = make_arti_info(buffs[i]);
                            row.appendChild(t[0]);
                            row.appendChild(t[1]);
                            t = make_arti_info(deals[i]);
                            row.appendChild(t[0]);
                            row.appendChild(t[1]);
                            artifact_info_table.appendChild(row);
                            }
                        }
                    </script>
                    <label>룬 강화 설정
                        <input type="checkbox" id="enc_chk" onchange="if(!checked){
                                rune_enchant_table.style.display='none';
                                document.getElementById('r_all_chk').checked=false;
                                for(let i=1;i<=6;i++)rune_enchant_table.getElementsByClassName('r_no'+i)[3].checked=false; }
                            else 
                                rune_enchant_table.style.display='block'"></label>
                    <table id='rune_enchant'>
                        <label class="tool_container">?<span class="tool_text">
                                룬이 15강 미만인 경우,<br /> 15강의 스텟으로 데미지를 계산합니다.<br /> 선택한 룬 번호만 계산됩니다.
                            </span></label>
                        <tr>
                            <td></td>
                            <th>타입</th>
                            <th>현재 수치</th>
                            <th>최종 수치</th>
                            <th>모두 선택<input type="checkbox" id="r_all_chk" onchange="javascript:if(this.checked){for(let i=1;i<=6;i++){
                                        rune_enchant_table.getElementsByClassName('r_no'+i)[3].checked=true;}
                                        }
                                        else{
                                            for(let i=1;i<=6;i++)
                                            rune_enchant_table.getElementsByClassName('r_no'+i)[3].checked=false;
                                            }">
                            </th>
                            </th>
                        </tr>
                        <tr>
                            <th>1번룬</th>
                            <td><select class="r_no1">
                                </select></td>
                            <td><input class="r_no1" id='r_no11' type="number" list="rune_datalist02" value="118"
                                    onmousedown="this.value='';"></td>
                            <td><input class="r_no1" id='r_no12' type="number" list="rune_datalist1" value="160"
                                    onmousedown="this.value='';"></td>
                            <td><input type="checkbox" class="r_no1" id='r_no13'
                                    onchange="if(!checked)document.getElementById('r_all_chk').checked=false"></td>
                        </tr>
                        <tr>
                            <th>2번%룬</th>
                            <td><select class="r_no2" id='r_no20'>
                                </select></td>
                            <td><input class="r_no2" id='r_no21' type="number" list="rune_datalist01" value="47"
                                    onmousedown="this.value='';"></td>
                            <td><input class="r_no2" id='r_no22' type="number" list="rune_datalist2" value="63"
                                    onmousedown="this.value='';"></td>
                            <td><input type="checkbox" class="r_no2" id='r_no23'
                                    onchange="if(!checked)document.getElementById('r_all_chk').checked=false"></td>
                        </tr>
                        <tr>
                            <th>3번룬</th>
                            <td>
                                <select class="r_no3">
                                </select>
                            </td>
                            <td><input class="r_no3" id='r_no31' type="number" list="rune_datalist02" value="118"
                                    onmousedown="this.value='';"></td>
                            <td><input class="r_no3" id='r_no32' type="number" list="rune_datalist1" value="160"
                                    onmousedown="this.value='';"></td>
                            <td><input type="checkbox" class="r_no3" id='r_no33'
                                    onchange="if(!checked)document.getElementById('r_all_chk').checked=false"></td>
                        </tr>
                        <tr>
                            <th>4번%룬</th>
                            <td><select class="r_no4" id='r_no40' onchange="datalistChangeCri(this)">
                                </select></td>
                            <td><input class="r_no4" id='r_no41' type="number" list="rune_datalist_cri" value="59"
                                    onmousedown="this.value='';"></td>
                            <td><input class="r_no4" id='r_no42' type="number" list="rune_datalist4" value="80"
                                    onmousedown="this.value='';"></td>
                            <td><input type="checkbox" class="r_no4" id='r_no43'
                                    onchange="if(!checked)document.getElementById('r_all_chk').checked=false"></td>
                        </tr>
                        <tr>
                            <th>5번룬</th>
                            <td><select class="r_no5">
                                </select></td>
                            <td><input class="r_no5" id='r_no51' type="number" list="rune_datalist03" value="1800"
                                    onmousedown="this.value='';"></td>
                            <td><input class="r_no5" id='r_no52' type="number" list="rune_datalist5" value="2448"
                                    onmousedown="this.value='';"></td>
                            <td><input type="checkbox" class="r_no5" id='r_no53'
                                    onchange="if(!checked)document.getElementById('r_all_chk').checked=false"></td>
                        </tr>
                        <tr>
                            <th>6번%룬</th>
                            <td><select class="r_no6" id='r_no60'>
                                </select></td>
                            <td><input class="r_no6" id='r_no61' type="number" list="rune_datalist01" value="47"
                                    onmousedown="this.value='';"></td>
                            <td><input class="r_no6" id='r_no62' type="number" list="rune_datalist2" value="63"
                                    onmousedown="this.value='';"></td>
                            <td><input type="checkbox" class="r_no6" id='r_no63'
                                    onchange="if(!checked)document.getElementById('r_all_chk').checked=false"></td>
                        </tr>
                        <datalist id='rune_datalist1'>
                            <option value="160">6성</option>
                            <option value="135">5성</option>
                        </datalist>
                        <datalist id='rune_datalist2'>
                            <option value="63">6성%</option>
                            <option value="51">5성%</option>
                        </datalist>
                        <datalist id='rune_datalist4'>
                            <option value="80">6성치피</option>
                            <option value="63">6성%</option>
                            <option value="65">5성치피</option>
                            <option value="51">5성%</option>
                        </datalist>
                        <datalist id='rune_datalist5'>
                            <option value="2448">6성</option>
                            <option value="2088">5성</option>
                        </datalist>
                        <datalist id='rune_datalist_cri'>
                            <option value="59">6성+12</option>
                            <option value="47">6성+9</option>
                            <option value="35">6성+6</option>
                            <option value="48">5성+12</option>
                            <option value="38">5성+9</option>
                        </datalist>
                        <datalist id='rune_datalist01'>
                            <option value="47">6성+12</option>
                            <option value="38">6성+9</option>
                            <option value="37">5성+12</option>
                            <option value="30">5성+9</option>
                        </datalist>
                        <datalist id='rune_datalist02'>
                            <option value="118">6성+12</option>
                            <option value="94">6성+9</option>
                            <option value="70">6성+6</option>
                        </datalist>
                        <datalist id='rune_datalist03'>
                            <option value="1800">6성+12</option>
                            <option value="1440">6성+9</option>
                            <option value="1080">6성+6</option>
                        </datalist>
                    </table>
                    <script>
                        const RUNE_HP_C = '체력(+)';
                        const RUNE_HP_P = '체력(%)';
                        const RUNE_ATK_C = '공격력(+)';
                        const RUNE_ATK_P = '공격력(%)';
                        const RUNE_DEF_C = '방어력(+)';
                        const RUNE_DEF_P = '방어력(%)';
                        const RUNE_SPD_C = '공격속도';
                        const RUNE_CD = '치명피해';
                        const rune_enchant_table = document.getElementById('rune_enchant');
                        function initRuneEnchant() {
                            const rows = rune_enchant_table.getElementsByTagName('select');
                            let list = [[RUNE_ATK_C],
                            [RUNE_ATK_P, RUNE_DEF_P, RUNE_HP_P],
                            [RUNE_DEF_C],
                            [RUNE_CD, RUNE_ATK_P, RUNE_DEF_P, RUNE_HP_P],
                            [RUNE_HP_C],
                            [RUNE_ATK_P, RUNE_DEF_P, RUNE_HP_P]];
                            for (i in list) {
                                for (ele of list[i]) {
                                    optionAddToSelect(rows[i], ele, ele);
                                }
                            }
                        }
                        function initShowRuneEnchantTable(){
                            if(document.getElementById('enc_chk').checked){
                                rune_enchant_table.style.display='block';
                            }
                            else{
                                rune_enchant_table.style.display='none';
                            }
                        }
                    </script>
                    <br />
                </div>
                <div class="col-5 main">
                    <table id='externel_stat_table'>
                        <tr>
                            <th>스텟</th>
                            <th>명예</th>
                            <th>깃발</th>
                            <th>길드스킬</th>
                        </tr>
                        <tr>
                            <td>체력%</td>
                            <td><input type="number" value="20" id='hhp' list='passive_datalist1'
                                    onmousedown="this.value='';">
                            </td>
                            <td><input type="number" value="20" id='fhp' list='passive_datalist1'
                                    onmousedown="this.value='';">
                            </td>
                            <td><input type="number" value="5" id='ghp' onmousedown="this.value='';"></td>
                        </tr>
                        <tr>
                            <td>공격력%</td>
                            <td class="tool_container attack">
                                <input type="number" value="41" id='hatk' list='passive_datalist4'
                                    onmousedown="this.value='';">
                                <span class="tool_text">고대의검+속성건물로 적어주세요. 만렙시 41%</span>
                            </td>
                            <td><input type="number" value="20" id='fatk' list='passive_datalist1'
                                    onmousedown="this.value='';">
                            </td>
                            <td><input type="number" value="5" id='gatk' onmousedown="this.value='';"></td>
                        </tr>
                        <tr>
                            <td>방어력%</td>
                            <td><input type="number" value="20" id='hdef' list='passive_datalist1'
                                    onmousedown="this.value='';">
                            </td>
                            <td><input type="number" value="20" id='fdef' list='passive_datalist1'
                                    onmousedown="this.value='';">
                            </td>
                            <td><input type="number" value="5" id='gdef' onmousedown="this.value='';"></td>
                        </tr>
                        <tr>
                            <td>공격속도%</td>
                            <td><input type="number" value="15" id='hspd' list='passive_datalist3'
                                    onmousedown="this.value='';">
                            </td>
                        </tr>
                        <tr>
                            <td>치명피해</td>
                            <td><input type="number" value="25" id='hcd' list='passive_datalist22'
                                    onmousedown="this.value='';">
                            </td>
                            <td><input type="number" value="25" id='fcd' list='passive_datalist2'
                                    onmousedown="this.value='';">
                            </td>
                        </tr>
                        <script>
                            const externel_stat_table = document.getElementById("externel_stat_table");
                            function initExternelStatTable() {
                                let rows = externel_stat_table.getElementsByTagName('tr');
                                rows[1].classList.add(STAT_HP);
                                rows[2].classList.add(STAT_ATK);
                                rows[3].classList.add(STAT_DEF);
                                rows[4].classList.add(STAT_SPD);
                                rows[5].classList.add(STAT_CD);
                            }

                        </script>
                        <datalist id='passive_datalist1'>
                            <option value="20">10레벨</option>
                            <option value="18">9레벨</option>
                            <option value="16">8레벨</option>
                            <option value="14">7레벨</option>
                            <option value="12">6레벨</option>
                            <option value="10">5레벨</option>
                            <option value="8">4레벨</option>
                            <option value="6">3레벨</option>
                            <option value="4">2레벨</option>
                            <option value="2">1레벨</option>
                        </datalist>
                        <datalist id='passive_datalist2'>
                            <option value="25">10레벨</option>
                            <option value="22">9레벨</option>
                            <option value="20">8레벨</option>
                            <option value="17">7레벨</option>
                            <option value="15">6레벨</option>
                            <option value="12">5레벨</option>
                            <option value="9">4레벨</option>
                            <option value="7">3레벨</option>
                            <option value="5">2레벨</option>
                            <option value="2">1레벨</option>
                        </datalist>
                        <datalist id='passive_datalist22'>
                            <option value="25">10레벨</option>
                            <option value="22">9레벨</option>
                            <option value="20">8레벨</option>
                            <option value="17">7레벨</option>
                            <option value="15">6레벨</option>
                            <option value="12">5레벨</option>
                            <option value="10">4레벨</option>
                            <option value="7">3레벨</option>
                            <option value="5">2레벨</option>
                            <option value="2">1레벨</option>
                        </datalist>
                        <datalist id='passive_datalist3'>
                            <option value="15">10레벨</option>
                            <option value="14">9레벨</option>
                            <option value="12">8레벨</option>
                            <option value="11">7레벨</option>
                            <option value="9">6레벨</option>
                            <option value="8">5레벨</option>
                            <option value="6">4레벨</option>
                            <option value="5">3레벨</option>
                            <option value="3">2레벨</option>
                            <option value="2">1레벨</option>
                        </datalist>
                        <datalist id='passive_datalist4'>
                            <option value="41">10+10레벨</option>
                            <option value="20">10레벨</option>
                            <option value="18">9레벨</option>
                            <option value="16">8레벨</option>
                            <option value="14">7레벨</option>
                            <option value="12">6레벨</option>
                            <option value="10">5레벨</option>
                            <option value="8">4레벨</option>
                            <option value="6">3레벨</option>
                            <option value="4">2레벨</option>
                            <option value="2">1레벨</option>
                        </datalist>
                    </table>
                    <div>
                        <label class='col-6 toggle_button' onclick="button_click(this,null)" id="isGW"><img src="guild_war.png" width="20px"
                                height="20px">길드전</label>
                        <label class='col-6 toggle_button' onclick="button_click(this,null)" id="isGS"><img src="guild_skill.png" width="20px"
                                height="20px">길드스킬</label>
                        <label class='col-4 toggle_button' onclick="button_click(this,null)" id="isABuff"><img src="increase_atk.png"
                                width="20px" height="20px">공격력버프</label>
                        <label class='col-4 toggle_button' onclick="button_click(this,null)" id="isDBuff"><img src="increase_def.png"
                                width="20px" height="20px">방어력버프</label>
                        <label class='col-4 toggle_button' onclick="button_click(this,null)" id="isSBuff"><img src="increase_spd.png"
                                width="20px" height="20px">공격속도버프</label>
                        <label class='col-4 toggle_button' onclick="button_click(this,null)" id='def_debuff'><img src='reduce_def.png'
                                width="20px" height="20px">방어력약화</label>
                        <label class='col-4 toggle_button' onclick="button_click(this,null)" id='brand'><img src='brand.png' width="20px"
                                height="20px">낙인</label>
                    </div>
                </div>
            </div>
            <br />
            <div class="row">
                <div class="col-8" id='etc_info_table'>
                    <table>
                        <tr>
                            <th>무슨계수?</th>
                            <td>
                                <select onchange='able_skill(this)' class="multi_type" id='type1'>
                                </select>
                            </td>
                            <td>
                                <select onchange='disable_skill2(this)' class="multi_type" id='type2'>
                                </select>
                                <script>
                                    const MULTYPE_NONE = 'null';
                                    const MULTYPE_ATK = 'attack_multi';
                                    const MULTYPE_DEF = 'defense_multi';
                                    const MULTYPE_SPD = 'speed_multi';
                                    const MULTYPE_HP = 'hp_multi';
                                    const MULTYPE_BOMB = 'bomb_multi';
                                    const skillMultiTypeName =
                                        [[MULTYPE_NONE, '미선택'], [MULTYPE_ATK, '공격력비례'], [MULTYPE_DEF, '방어력비례'],
                                        [MULTYPE_SPD, '공격속도비례'], [MULTYPE_HP, '체력비례'], [MULTYPE_BOMB, '폭탄']];

                                    function initMultiTypeSelect() {
                                        let tag = etc_info_table.getElementsByClassName('multi_type');
                                        for (k in tag) {
                                            for (idx in skillMultiTypeName) {
                                                if (k == 1 && skillMultiTypeName[idx][0] == MULTYPE_SPD) continue; //1번계수 && 공속비례인 경우
                                                if (k == 0 && skillMultiTypeName[idx][0] == MULTYPE_NONE) continue; //2번계수 && null인 경우
                                                optionAddToSelect(tag[k], skillMultiTypeName[idx][0], skillMultiTypeName[idx][1]);
                                            }
                                        }
                                    }
                                    function able_skill(obj) {
                                        let skill_multi = etc_info_table.getElementsByClassName("skill_multi");
                                        if (obj.value == 'speed_multi') {
                                            skill_multi[1].disabled = false;
                                        }
                                        else if (skill_multi[1].value == 'null') {
                                            skill_multi[1].disabled = true;
                                        }
                                    }
                                    function disable_skill2(obj) {
                                        let skill_multi = etc_info_table.getElementsByClassName("skill_multi");
                                        let multi_type = etc_info_table.getElementsByClassName("multi_type");
                                        let skill_level = etc_info_table.getElementsByClassName("skill_level");
                                        if (obj.value == 'null') {
                                            skill_level[1].disabled = true;
                                            if (multi_type[0].value != 'speed_multi') {
                                                skill_multi[1].disabled = true;
                                            }
                                        }
                                        else {
                                            skill_level[1].disabled = false;
                                            skill_multi[1].disabled = false;
                                        }
                                    }
                                </script>
                            </td>
                            <td>
                            </td>

                        </tr>
                        <tr class="multi">
                            <th>스킬 계수</th>
                            <td><input type="number" class="skill_multi" placeholder="1번계수" id='mul1'></td>
                            <td><input type="number" class="skill_multi" placeholder="2번계수" id='mul2'></td>
                            <td>
                                <label class="tool_container">
                                    <span>
                                        ?
                                        <span class="tool_text">
                                            공,방비례,폭탄 계수인 경우: 1번계수입력<br />
                                            속비례 계수인 경우: <br />
                                            1번계수는 더하는 값, 2번계수는 나누는값<br />
                                            예를들어 물이프는 210, 0.7순<br />
                                            크리티컬이 터지지 않는 경우 : 음수로 입력
                                        </span>
                                    </span></label>
                            </td>
                        </tr>
                        <tr>
                            <th>스킬작</th>
                            <td><input type="number" class="skill_level" placeholder="데미지%" id='lv1'></td>
                            <td><input type="number" class="skill_level" placeholder="데미지%" id='lv2' disabled></td>
                            <td>
                            </td>

                        </tr>
                        <tr>
                            <th>리더스킬</th>
                            <td>
                                <select class='leader_type' id="l_type">
                                </select>
                                <script>
                                    const LEADER_NONE = "none";
                                    const LEADER_HP = STAT_HP;
                                    const LEADER_ATK = STAT_ATK;
                                    const LEADER_DEF = STAT_DEF;
                                    const LEADER_SPD = STAT_SPD;
                                    const leaderTypes = [[LEADER_NONE, "없음"], [LEADER_HP, "체력%"], [LEADER_ATK, "공격력%"]
                                        , [LEADER_DEF, "방어력%"], [LEADER_SPD, "공격속도%"]];
                                    function initLeaderTypeSelect() {
                                        let obj = document.getElementById("l_type");
                                        for (i in leaderTypes) {
                                            optionAddToSelect(obj, leaderTypes[i][0], leaderTypes[i][1]);
                                        }
                                    }
                                </script>
                            </td>
                            <td><input type="number" class='leader_value' id="l_v"></td>
                            <td>
                            </td>

                        </tr>
                        <tr>
                            <th>이계룬 개수</th>
                            <td><input type="number" class='dimension' id="dimen" placeholder="개당 8%"></td>
                            <td>
                                <label class="tool_container">
                                    <span>
                                        ?
                                        <span class="dimension tool_text">
                                            첫 번째 계수가<br>
                                            공격력, 공격속도, 폭탄 계수일 때 : 투지<br>
                                            방어력 : 결의<br>
                                            체력 : 고양으로 계산
                                        </span>
                                    </span>
                                </label>
                            </td>
                            <td>
                            </td>

                        </tr>
                        <tr>
                            <th>적의 방어력</th>
                            <td><input type="number" class='enemy_def' id="e_def" placeholder="방무는 0"></td>
                            <td><span class='def_dmg' title="1000/(1140+방어력*3.5)"></span></td>
                            <td>
                            </td>
                        </tr>
                        <tr>
                            <th>
                            <span class='relative_spd toggle_button white_button' id='r_spd' onclick="button_click(this, useRelativeSpdMul)">
                            상대 속도계수</span>
                            </th>
                            <td colspan='3'>
                                <input type="number" class="enemy_spd" id='e_s1' placeholder="적기본속">
                                + <input type="number" class="enemy_spd" id='e_s2' placeholder="적 뒷속">
                                = <input type="number" class="enemy_spd" id='e_s3' placeholder="총 속도" disabled>
                                배율:<span class='enemy_spd'></span>
                            </td>
                        </tr>
                        <script>
                            function isButtonTrueState(tag) {
                                return tag.classList.contains('green_button');
                            }
                            function setButtonState(tag, bool) {
                                if(bool){
                                tag.classList.remove('white_button');
                                tag.classList.add('green_button');
                                }
                                else{
                                tag.classList.add('white_button');
                                tag.classList.remove('green_button');
                                }
                            }
                            function button_click(obj, callback) {
                                obj.classList.toggle("white_button");
                                obj.classList.toggle("green_button");
                                let use = isButtonTrueState(obj);
                                if(callback == null) return;
                                callback(use);
                            }
                            function useRelativeSpdMul(isUse) {
                                let tag = etc_info_table.getElementsByClassName('enemy_spd');
                                for (let i = 0; i < 2; i++) {
                                    tag[i].disabled = !isUse;
                                }
                            }
                            function initRelativeSpdMulInput(){
                                useRelativeSpdMul(isButtonTrueState(etc_info_table.getElementsByClassName('relative_spd')[0]));
                            }
                        </script>
                        <tr>
                            <th>증가데미지</th>
                            <td><input class='increase_dmg' id='inc' type="number"></td>
                            <td></td>
                            <td>
                            </td>

                        </tr>
                    </table>
                </div>
                <div id='saved_datalist' class='col-4'>
                    <details>
                    <summary>
                    저장된 목록 보기
                    </summary>
                    <div>
                    </div>
                    </details>
                </div>
                <script>
                const etc_info_table = document.getElementById('etc_info_table');
                    let save_datalist_container = document.getElementById('saved_datalist').getElementsByTagName('div')[0];
                    function add_save_data_item(map_item){
                            let callbacks = [['click',function(){
                            load_data_by(map_item[1][0]);
                            }]];
                            
                        let li = document.createElement('div');
                        let span = document.createElement('span');
                        let del = document.createElement('span');
                        let time_tag = document.createElement('span');
                        span.classList.add('decorate');
                        span.classList.add('col-9');
                        del.classList.add('decorate');
                        del.classList.add('col-3');
                        for(let cb of callbacks){
                        span.addEventListener(cb[0], cb[1],false);
                        }
                        span.innerHTML = map_item[0];
                        del.innerHTML = '삭제';
                        
                        time_tag.innerHTML = '등록시간 : '+new Date(map_item[1][1]).toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' });
                        li.style.marginBottom = '8px';
                        del.addEventListener('click', function(){
                            if(!confirm(map_item[0]+'를(을) 삭제하실 건가요?')) return;
                            save_datalist_container.removeChild(li);
                            save_data_map.delete(map_item[0]);
                        });
                        li.appendChild(span);
                        li.appendChild(del);
                        li.appendChild(time_tag);
                        save_datalist_container.appendChild(li);
                    }
                    function load_save_data_list(){
                        let map_str = localStorage.getItem(STAT_SAVE_DATA_LIST);
                        if(map_str ==null){
                            save_data_map = new Map();
                        }
                        else{
                            save_data_map = new Map(JSON.parse(map_str));
                        }
                        for(let element of save_data_map){
                            add_save_data_item(element);
                        };
                    }
                </script>
                <div class="col-4 tool_container">
                    <div class="col-4 result">
                        <span class="error_range tool_text">데이터가 없습니다.</span>
                        예상 데미지는<br />
                        <span id="result"></span>
                    </div>
                </div>
            </div>
            <div class="col-12">
                <input type='button' id='input_reset' onclick="if(confirm('정말로 초기화하시겠습니까?')){ 
                document.getElementById('reset_form').reset();
                rune_enchant_table.style.display='none';
                }" value='입력값 초기화'/>
            </div>
        </form>
        <button class="col-12" onclick="damageCalculate()"
            style="margin:25px 0 25px 0; cursor:pointer;">계산하기(Enter)</button>


        <hr />
        <script>
            function copy_to_clipboard() {
                var copy_string = saveInputData(false);
                var copyText = document.getElementById("clipboard_text");
                copyText.value = copy_string;
                copyText.select();
                document.execCommand("Copy");
            }
            function querystring_save(){
                save_name = prompt("저장할 이름을 입력해주세요.");
                if(save_name == null || save_name == ''){
                    return;
                }
                if(save_data_map.get(save_name) != undefined){
                    if(!confirm('이미 존재하는 이름입니다. 덮어 씌우실 건가요?')){
                        return;
                    }
                }
                var query_string = saveInputData(false).split('?')[1];
                let time = Date.now();
                save_data_map.set(save_name,[query_string, time]);
                add_save_data_item([save_name, [query_string, time]]);
                alert('저장되었습니다.');
            }
            function load_data_by(queryString){
                readInputData(queryString);
                alert('불러왔습니다.');
                init_after_load();
            }
        </script>
        <div>
            <button style="display: none;" id="view_recode" onclick="openRecord()">계산 기록보기</button>
            <button id="copy_clipboard" onclick="copy_to_clipboard()">계산 링크 복사</button>
            <button id='now_status_save' onclick="querystring_save()">저장</button>


            <div id="record">
                <div id="record_container"></div>
                <button class="icon" onclick="exitRecord()" title="창 닫기" style="right:5px;">X</button>
                <button class="icon" onclick="resetRecord()" title="기록 초기화" style="right:50px;">◁</button>
            </div>
            <script>
                function optionAddToSelect(selectTag, value, text) {
                    selectTag.innerHTML += '<option value="' + value + '">'
                        + text + '</option>';
                }
                function getUrlParams(queryString) {
                    var params = {};
                    var location = queryString;
                    if(queryString == undefined)
                        location = window.location.search;
                    location.replace(/[?&]?([^=&]+)=([^&]*)/gi, function (str, key, value) {params[key] = value;});
                    return params;
                }
                function getFloatFrom(inputTag) {
                    if (inputTag != null) {
                        let val = parseFloat(inputTag.value);
                        if (isNaN(val)) return 0;
                        return val;
                    }
                    return 0;
                }
                function getIntFrom(inputTag) {
                    if (inputTag != null) {
                        let val = parseInt(inputTag.value);
                        if (isNaN(val)) return 0;
                        return val;
                    }
                    return 0;
                }
                function getFloatArrayFrom(inputArray) {
                    let arr = [];
                    for (let i = 0; i < inputArray.length; i++) {
                        arr[i] = getFloatFrom(inputArray[i]);
                    }
                    return arr;
                }
                function getIntArrayFrom(inputArray) {
                    let arr = [];
                    for (let i = 0; i < inputArray.length; i++) {
                        arr.push(getIntFrom(inputArray[i]));
                    }
                    return arr;
                }
                function getValueArrayFrom(Classes) {
                    let arr = [];
                    for (let i = 0; i < Classes.length; i++) {
                        arr.push(Classes[i].value);
                    }
                    return arr;
                }
                function changeTextColorByNumber(inputTag) {
                    var num = getIntFrom(inputTag);
                    if (num > 0) {
                        inputTag.style.color = "green";
                    }
                    else if (num < 0) {
                        inputTag.style.color = "red";
                    }
                    else {
                        inputTag.style.color = "black";
                    }
                }
                let inputTags;
                function initInputTags() {
                    inputTags = document.querySelectorAll(".toggle_button, input[type='number'], input[type='checkbox'], " +
                        "select");
                }
                function saveInputData(isLocal) {
                    queryString = window.location.origin + window.location.pathname + "?";
                    for (let i = 0; i < inputTags.length; i++) {
                        let item = inputTags[i];
                        if(item.id == '') continue;
                        let name = item.id;
                        if(item.classList.contains('toggle_button')){
                            if (isLocal) {
                                localStorage.setItem(name, isButtonTrueState(item));
                            }
                            else {
                                queryString += name + "=" +isButtonTrueState(item) + "&";
                            }
                        }
                        else if (item.type == "checkbox") {
                            if (isLocal) {
                                localStorage.setItem(name, item.checked);
                            }
                            else {
                                queryString += name + "=" + item.checked + "&";
                            }
                        }
                        else {
                            if (isLocal) {
                                localStorage.setItem(name, item.value);
                            }
                            else {
                                queryString += name + "=" + item.value + "&";
                            }
                        }
                    }
                    return queryString;
                }
                function readInputData(query) {
                    let queryMap;
                    if(query == undefined){
                        queryMap = getUrlParams();
                    }
                    else{
                        queryMap = getUrlParams(query);
                    }
                    for (let i = 0; i < inputTags.length; i++) {
                        let item = inputTags[i];
                        if (item.id == '') continue; 
                        let name = item.id;
                        if(item.classList.contains('toggle_button')){
                            if (queryMap[name] == "true" || (queryMap[name] == undefined&&localStorage.getItem(name) == "true")) {
                                setButtonState(item, true);
                            }
                            else {
                                setButtonState(item, false);
                            }
                        }
                        else if (item.type == "checkbox") {
                            if (queryMap[name] == "true" || (queryMap[name] == undefined&&localStorage.getItem(name) == "true")) {
                                item.checked = true;
                            }
                            else {
                                item.checked = false;
                            }
                        }
                        else {
                            if (queryMap[name] == undefined) {
                                item.value = localStorage.getItem(name);
                            }
                            else {
                                item.value = queryMap[name]
                            }
                        }
                    }
                    damageCalculate();
                }

                function setValuesTo(inputTags, inputs) {
                    for (i in inputTags) {
                        if (inputs[i] == null) continue;
                        inputTags[i].value = inputs[i];
                    }
                }
                const skill_multi_Type_tags = etc_info_table.getElementsByClassName("multi_type");
                const skill_multi_tags = etc_info_table.getElementsByClassName("skill_multi");
                const skill_level_tags = etc_info_table.getElementsByClassName("skill_level");
                const autoInfo = class {
                    constructor(stats, mulTypes, multis, levels, def, leader_type, leader_value) {
                        this.stats = stats;
                        this.mulTypes = mulTypes;
                        this.multis = multis;
                        this.levels = levels;
                        this.def = def;
                        this.leaderType = leader_type;
                        this.leaderValue = leader_value;
                    }
                }
                const autoinfoList =
                    [
                        ['등록된 계수 선택', new autoInfo([null, null, null, null, null], [null, null], [null, null], [null, null], null, null, null)],
                        ['풍조커(3스)', new autoInfo([null, 900, null, 103, null], [MULTYPE_ATK, MULTYPE_NONE], [68, null], [30, null], 0, LEADER_ATK, null)],
                        ['풍리빙(3스)', new autoInfo([null, 483, 692, null, null], [MULTYPE_DEF, MULTYPE_ATK], [300, 300], [30, 30], 0, LEADER_DEF, null)],
                        ['불프랑켄(3스)', new autoInfo([null, null, 615, null, null], [MULTYPE_DEF, MULTYPE_NONE], [160, null], [25, null], 0, LEADER_DEF, 21)],
                        ['풍발키리(3스)', new autoInfo([null, 801, null, null, null], [MULTYPE_ATK, MULTYPE_NONE], [280, null], [20, null], 0, LEADER_ATK, null)],
                        ['빛임프(3스)', new autoInfo([null, 604, null, null, null], [MULTYPE_ATK, MULTYPE_NONE], [370, null], [30, null], 0, LEADER_ATK, null)],
                        ['불하엘(2스)', new autoInfo([null, 878, null, null, null], [MULTYPE_ATK, MULTYPE_NONE], [300, null], [25, null], 0, LEADER_ATK, null)],
                        ['풍선인(3스)', new autoInfo([null, 769, null, null, null], [MULTYPE_ATK, MULTYPE_NONE], [800, null], [30, null], null, LEADER_ATK, null)],
                        ['물스나(3스)', new autoInfo([null, 780, null, null, null], [MULTYPE_ATK, MULTYPE_NONE], [400, null], [25, null], 0, LEADER_ATK, null)],
                        ['풍팬더(평타)', new autoInfo([null, 659, 801, null, null], [MULTYPE_DEF, MULTYPE_ATK], [-160, 130], [35, 25], null, LEADER_DEF, 44)]
                    ];
                function initAutoMultiSelect() {
                    let tag = document.getElementsByClassName("auto_multi_select")[0];
                    for (let i in autoinfoList) {
                        optionAddToSelect(tag, autoinfoList[i][0], autoinfoList[i][0]);
                    }
                }
                function multiAutoSelect(obj) {
                    let idx = obj.selectedIndex;
                    multiChange(autoinfoList[idx][1]);
                }
                function multiChange(autoinfo) {
                    setValuesTo(stat_info_table.getElementsByClassName('base'), autoinfo.stats);
                    setValuesTo(skill_multi_Type_tags, autoinfo.mulTypes);
                    setValuesTo(skill_multi_tags, autoinfo.multis);
                    setValuesTo(skill_level_tags, autoinfo.levels);
                    etc_info_table.getElementsByClassName("enemy_def")[0].value = autoinfo.def;
                    document.getElementsByClassName("leader_type")[0].value = autoinfo.leaderType;
                    etc_info_table.getElementsByClassName("leader_value")[0].value = autoinfo.leaderValue;
                    disable_skill2(skill_multi_Type_tags[1]);
                }
                var recordCount = 0;
                //return : [예측 데미지, 아티팩트 데미지 비중 %]
                function get_damage(multi_types, stats, multis, skillLevels, def_dmg) {
                    let dmg = 0;
                    let stat;
                    let multi;
                    let dmg_reduct;
                    let cri = stats[STAT_CD_IDX];
                    let isSBuffType = false;
                    for (let i in multi_types) {
                        //크리가 터지지 않는 경우
                        if (multis[i] < 0) {
                            cri = 0;
                            multi = -multis[i];
                        }
                        else {
                            multi = multis[i];
                        }
                        //swarfarm, wiki 계수 사이 임계값
                        if(multi < 20)
                            multi *= 100;
                        dmg_reduct = def_dmg;
                        switch (multi_types[i]) {
                            case MULTYPE_HP:
                                stat = stats[STAT_HP_IDX];
                                break;
                            case MULTYPE_BOMB:
                                stat = stats[STAT_ATK_IDX];
                                cri = 0; dmg_reduct = 1;
                                break;
                            case MULTYPE_SPD:
                                //swarfarm, wiki 계수 사이 임계값
                                if(multis[1] > 5)
                                    multis[1] /= 100;
                                multi = (stats[STAT_SPD_IDX] + multis[0]) / multis[1];
                                isSBuffType = true;
                            case MULTYPE_ATK:
                                stat = stats[STAT_ATK_IDX];
                                break;
                            case MULTYPE_DEF:
                                stat = stats[STAT_DEF_IDX];
                                break;
                            case MULTYPE_NONE:
                                multi = 0;
                                break;
                        }
                        dmg += stat * multi * (100 + cri + skillLevels[i]) * dmg_reduct / 10000;
                        if (isSBuffType) break;
                    }
                    arti_atk = getIntFrom(artifact_info_table.getElementsByClassName(ARTIFACT_ATK_DEAL)[0]);
                    arti_hp = getFloatFrom(artifact_info_table.getElementsByClassName(ARTIFACT_HP_DEAL)[0]);
                    arti_def = getIntFrom(artifact_info_table.getElementsByClassName(ARTIFACT_DEF_DEAL)[0]);
                    arti_spd = getIntFrom(artifact_info_table.getElementsByClassName(ARTIFACT_SPD_DEAL)[0]);
                    artifact =
                    (stats[STAT_ATK_IDX] * arti_atk +
                    stats[STAT_HP_IDX] * arti_hp +
                    stats[STAT_DEF_IDX] * arti_def +
                    stats[STAT_SPD_IDX] * arti_spd)/100;

                    return [dmg + artifact, artifact * 100 / (dmg + artifact)];
                }
                function getExternelStats(statClassName, isGW, isGS) {
                    let rows = externel_stat_table.getElementsByClassName(statClassName)[0].getElementsByTagName('input');
                    let ret = getIntFrom(rows[0]);
                    if (isGW)
                        ret += getIntFrom(rows[1]);
                    if (isGS)
                        ret += getIntFrom(rows[2]);
                    return ret;
                }
                function getDimensionPercent(mulType, dimenCount) {
                    switch (mulType) {
                        case MULTYPE_HP:
                            return [STAT_HP_IDX, dimenCount * 8];
                        case MULTYPE_ATK:
                        case MULTYPE_SPD:
                        case MULTYPE_BOMB:
                            return [STAT_ATK_IDX, dimenCount * 8];
                        case MULTYPE_DEF:
                            return [STAT_DEF_IDX, dimenCount * 8];
                    }
                    return 0;
                }
                function getDiff(input1, input2, checkbox) {
                    if (checkbox.checked) {
                        return getIntFrom(input2) - getIntFrom(input1);
                    }
                    return 0;
                }

                const RUNE_CONST = 0;
                const RUNE_PERCENT = 1;
                //ret = [[const], [percent]];
                function getEnchantStats() {
                    let ret = [[], []];
                    for (i in statClassName) {
                        ret[0][i] = 0;
                        ret[1][i] = 0;
                    }
                    if(document.getElementById('enc_chk').checked){
                    for (let i = 1; i <= 6; i++) {
                        let rows = rune_enchant_table.getElementsByClassName('r_no' + i);
                        switch (rows[0].value) {
                            case RUNE_HP_C: ret[RUNE_CONST][STAT_HP_IDX] += getDiff(rows[1], rows[2], rows[3]);
                                break;
                            case RUNE_HP_P: ret[RUNE_PERCENT][STAT_HP_IDX] += getDiff(rows[1], rows[2], rows[3]);
                                break;
                            case RUNE_ATK_C: ret[RUNE_CONST][STAT_ATK_IDX] += getDiff(rows[1], rows[2], rows[3]);
                                break;
                            case RUNE_ATK_P: ret[RUNE_PERCENT][STAT_ATK_IDX] += getDiff(rows[1], rows[2], rows[3]);
                                break;
                            case RUNE_DEF_C: ret[RUNE_CONST][STAT_DEF_IDX] += getDiff(rows[1], rows[2], rows[3]);
                                break;
                            case RUNE_DEF_P: ret[RUNE_PERCENT][STAT_DEF_IDX] += getDiff(rows[1], rows[2], rows[3]);
                                break;
                            case RUNE_SPD_C: ret[RUNE_CONST][STAT_SPD_IDX] += getDiff(rows[1], rows[2], rows[3]);
                                break;
                            case RUNE_CD: ret[RUNE_CONST][STAT_CD_IDX] += getDiff(rows[1], rows[2], rows[3]);
                                break;
                        }
                    }
                    }
                    return ret;
                }
                function getBoolFrom(checkbox) {
                    return checkbox.checked
                }
                
                function damageCalculate() {
                    let multi_types = getValueArrayFrom(etc_info_table.getElementsByClassName("multi_type"));
                    let dimensionCount = getIntFrom(etc_info_table.getElementsByClassName("dimension")[0]);
                    let leader_type = etc_info_table.getElementsByClassName("leader_type")[0].value;
                    let leader_value = getIntFrom(etc_info_table.getElementsByClassName("leader_value")[0]);
                    let isGW = isButtonTrueState(document.getElementById("isGW"));
                    let isGS = isButtonTrueState(document.getElementById("isGS"));
                    //강화시 룬[valueType][statType]
                    let enchanted_rune = getEnchantStats();

                    //방어력 및 계수 선택
                    var enemy_def = getIntFrom(etc_info_table.getElementsByClassName("enemy_def")[0]);
                    if (isButtonTrueState(document.getElementById("def_debuff"))) 
                        enemy_def *= 0.3;
                    var def_dmg = 1000 / (1140 + enemy_def * 3.5);
                    etc_info_table.getElementsByClassName("def_dmg")[0].innerHTML = " 데미지 경감 : " + def_dmg.toFixed(2);
                    let multis = getFloatArrayFrom(etc_info_table.getElementsByClassName("skill_multi"));
                    let skillLevels = getIntArrayFrom(etc_info_table.getElementsByClassName("skill_level"));

                    let dimen = getDimensionPercent(multi_types[0], dimensionCount);
                    //버프
                    let buffs = [1, 1, 1, 1, 1];
                    if (isButtonTrueState(document.getElementById('isSBuff'))){
                        buffs[STAT_SPD_IDX] =
                        1.3 + 0.3 * getIntFrom(artifact_info_table.getElementsByClassName(ARTIFACT_SPD_BUFF)[0]) / 100;
                    }
                    if (isButtonTrueState(document.getElementById('isDBuff'))){
                        buffs[STAT_DEF_IDX] =
                        1.7 + 0.7 * getIntFrom(artifact_info_table.getElementsByClassName(ARTIFACT_DEF_BUFF)[0]) / 100;
                    }
                    if (isButtonTrueState(document.getElementById('isABuff'))){
                        buffs[STAT_ATK_IDX] =
                        1.5 + 0.5 * getIntFrom(artifact_info_table.getElementsByClassName(ARTIFACT_ATK_BUFF)[0]) / 100;
                    }

                    let externel_percent = []
                    let leader_percent = [];
                    let statSums = [];
                    let beforeStatSums = [];
                    for (i in stat_infos) {
                        let base = getIntFrom(stat_infos[i].getElementsByClassName("base")[0]);
                        let rune = getIntFrom(stat_infos[i].getElementsByClassName("rune")[0]);
                        let disp = getIntFrom(stat_infos[i].getElementsByClassName("disp")[0]);
                        //명예/깃발/길드스텟 퍼센트
                        externel_percent[i] = getExternelStats(statClassName[i], isGW, isGS);
                        //리더 퍼센트
                        leader_percent[i] = ((statClassName[i] == leader_type) ? leader_value : 0);
                        //이계룬 퍼센트
                        let dimen_percent = 0;
                        if (dimen[0] == i) {
                            dimen_percent = dimen[1];
                        }
                        let percent_beforesum = externel_percent[i] + dimen_percent + leader_percent[i];
                        let percent_sum = percent_beforesum + enchanted_rune[RUNE_PERCENT][i];
                        if (i == STAT_CD_IDX) {
                            beforeStatSums[i] = base + percent_beforesum + rune;
                            statSums[i] = base + percent_sum + rune + disp + enchanted_rune[RUNE_CONST][i];
                        }
                        else {
                            beforeStatSums[i] = Math.ceil(base * (100 + percent_beforesum) / 100) + rune;
                            statSums[i] = Math.ceil(base * (100 + percent_sum) / 100) + rune + disp + enchanted_rune[RUNE_CONST][i];
                        }
                        beforeStatSums[i] = Math.ceil(beforeStatSums[i] * buffs[i]);
                        statSums[i] = Math.ceil(statSums[i] * buffs[i]);
                        stat_infos[i].getElementsByClassName("tool_text")[0].innerHTML =
                            "기본 : " + base + ", 룬 : " + (rune + disp) +
                            ", 룬강 : " + parseInt(base * enchanted_rune[RUNE_PERCENT][i] / 100 + enchanted_rune[RUNE_CONST][i]) +
                            ", 명예/깃발/길드스킬 : " + (base * externel_percent[i] / 100) + ", 리더 : " + (base * leader_percent[i]) / 100;
                        stat_infos[i].getElementsByClassName("sum")[0].innerHTML = statSums[i];
                    }
                    //계산식
                    var ret_dmg = get_damage(multi_types, statSums, multis, skillLevels, def_dmg);
                    var ret_before_dmg = get_damage(multi_types, beforeStatSums, multis, skillLevels, def_dmg);
                    var dmg = ret_dmg[0];
                    var before_dmg = ret_before_dmg[0];

                    //상대 속도 계수
                    let enemy_spd, relativeSpdMul=1;
                    if(isButtonTrueState(etc_info_table.getElementsByClassName('relative_spd')[0])){
                    let relative_spd_inputs = etc_info_table.getElementsByClassName('enemy_spd');
                    enemy_spd = getIntArrayFrom(relative_spd_inputs);
                    let e_spd = Math.ceil(enemy_spd[0]*(100+leader_percent[STAT_SPD_IDX]+externel_percent[STAT_SPD_IDX])/100 + enemy_spd[1]);
                    relativeSpdMul = statSums[STAT_SPD_IDX]/e_spd;
                    relative_spd_inputs[2].value = e_spd;
                    relative_spd_inputs[3].innerHTML = relativeSpdMul.toFixed(2);
                    if(!isFinite(relativeSpdMul)){
                        alert("Error : 상대의 속도가 0이므로 상대속도계수를 무시하고 계산합니다.");
                        relativeSpdMul = 1;
                    }
                    }
                    dmg = Math.ceil(dmg*relativeSpdMul);
                    before_dmg = Math.ceil(before_dmg*relativeSpdMul);
                    //증뎀
                    let increase_dmg = getIntFrom(etc_info_table.getElementsByClassName("increase_dmg")[0]);
                    dmg = dmg + parseInt(dmg * increase_dmg / 100);
                    before_dmg = before_dmg + parseInt(before_dmg * increase_dmg / 100);
                    //낙인
                    if (isButtonTrueState(document.getElementById("brand"))) {
                        dmg = parseInt(dmg * 1.25);
                        before_dmg = parseInt(before_dmg * 1.25);
                    }
                    document.getElementById("result").innerHTML = Math.ceil(dmg);
                    document.getElementsByClassName("error_range")[0].innerHTML =
                        "서머내 오차범위 : " + Math.floor(dmg * 0.97) + "~" + Math.ceil(dmg * 1.03) +'<br>'
                        + "추가데미지 : " + Math.floor(ret_dmg[1]*dmg/100);

                    document.getElementsByClassName("error_range")[0].innerHTML += "<br>바꾸기 전 : " + Math.ceil(before_dmg);
                }
                function openRecord() {
                    document.getElementById("record").style.display = "block";
                    document.getElementById("record").style.visibility = "visible";
                }
                function exitRecord() {
                    document.getElementById("record").style.display = "none";
                    document.getElementById("record").style.visibility = "hidden";
                }
                function resetRecord() {
                    recordCount = 0;
                    document.getElementById("record_container").innerHTML = "";
                }
                function rateConfirm(myId, min, max) {
                    if (document.getElementById(myId).value < min) {
                        document.getElementById(myId).value = 15;
                    };
                    if (document.getElementById(myId).value > max) {
                        document.getElementById(myId).value = 100;
                    };
                }
                function datalistChangeCri(node) {
                    let datalist = document.getElementById("rune_datalist_cri");
                    if (node.value == RUNE_CD) {
                        datalist.innerHTML = '<option value="59">6성+12</option>';
                        datalist.innerHTML += '<option value="47">6성+9</option>';
                        datalist.innerHTML += '<option value="35">6성+6</option>';
                        datalist.innerHTML += '<option value="65">5성+12</option>';
                        datalist.innerHTML += '<option value="38">5성+9</option>';
                    }
                    else {
                        datalist.innerHTML = '<option value="47">6성+12</option>';
                        datalist.innerHTML += '<option value="63">6성+9</option>';
                        datalist.innerHTML += '<option value="37">5성+12</option>';
                        datalist.innerHTML += '<option value="30">5성+9</option>';
                    }
                }

            </script>
    </section>
    <footer class="col-12 footer">
        <a href="https://swarfarm.com/" target="_blank"
            class='col-12' style="width:100%; margin:5px 0">
            <span class="link">몬스터 계수 참고 사이트</span>
        </a>
        <a href="http://summonerswar.wikia.com/wiki/Guide:Skill_damage" target="_blank"
            class='col-12' style="width:100%; margin:5px 0">
            <span class="link">데미지 계산식 참고 링크</span>
        </a>
        <hr />
        <a href="https://veev23.github.io/2018-swar/SpeedCalc" target="_blank"
            class='col-12' style="width:100%; margin:5px 0">
            <span class="link">중턴 계산기</span>
        </a>
        <a href="https://veev23.github.io/" target="_blank"
            class='col-12' style="width:100%;margin:5px 0">
            <span class="link">설명 페이지</span>
        </a>
        <p style="text-align: center;">마지막 수정일 : 2020-08-07</p>
        <p style="text-align: center;">문의 : 서머너즈워 공식카페 '안돼요옷' 채팅남겨주세요.</p>
        <input id="clipboard_text" style="width:10px" />
    </footer>
</body>
<script>
    function init_after_load(){
        initShowRuneEnchantTable();
        disable_skill2(skill_multi_Type_tags[1]);
        initRelativeSpdMulInput();
    }
    function main() {
        make_stat_info_table();
        make_artifact_info_table();
        initAutoMultiSelect();
        initRuneEnchant();
        initExternelStatTable();
        initLeaderTypeSelect();
        initMultiTypeSelect();

        initInputTags();
        readInputData();
        load_save_data_list();

        init_after_load();
    }
    main();
</script>

</html>
